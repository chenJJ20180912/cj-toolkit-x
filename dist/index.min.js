!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).index=t.index||{})}(this,(function(t){"use strict";class e{error(t,e){throw console.error(t),new Error(e)}}var s=new class{constructor(){this._defaultErrorHandler=new e}isNull(t,e,s=this._defaultErrorHandler){void 0!==t&&""!==t&&null!==t||s.error([t],e)}isNotNull(t,e,s=this._defaultErrorHandler){void 0!==t&&""!==t&&null!==t&&s.error([t],e)}isEmpty(t,e,s=this._defaultErrorHandler){this.isNull(t,e,s),Array.isArray(t)&&0===t.length&&s.error([t],e)}isNotEmpty(t,e,s=this._defaultErrorHandler){this.isNotNull(t,e,s),Array.isArray(t)&&t.length>0&&s.error([t],e)}};class i{constructor(){this.type="Local",this.pluginName="cacheManager",this.ttlEnabled=!0,this.ttlInterval=1e3}}var r=new class{constructor(){this.typeMapping={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}}isObject(t){return"object"===this.getObjType(t)}addObjType(t,e){let s=Object.prototype.toString;this.typeMapping[s.call(t)]=e}getObjType(t){let e=Object.prototype.toString;return t instanceof Element?"element":this.typeMapping[e.call(t)]}deepClone(t){let e=this.getObjType(t);if(Array.isArray(t)){let e=[];for(let s=0,i=t.length;s<i;s++)t[s]=(t[s],t[s]),t[s]&&delete t[s].$parent,e.push(this.deepClone(t[s]));return e}if("object"===e){let e={};for(let s in t)t&&delete t.$parent,e[s]=this.deepClone(t[s]);return e}return t}};class n{constructor(t=15e3){this.enabled=!0,this.interval=t}start(t,e){this.stop(),this.interval>0&&this.enabled&&(this.timerId=setInterval(()=>{t(e)},this.interval))}stop(){clearInterval(this.timerId)}setEnabled(t){this.enabled=t}setInterval(t=15e3){this.interval=t}}class a{newCacheRegion(t,e,s){return new o(t,e,s)}newTimer(){return new n}}class l{constructor(t,e){this._reginData={},this._queue=new Set,this.cacheManagerPropertyFactory=e,this.storageProvider=t,this.ttlTimer=e.newTimer()}install(t){this._app=t}ready(t){this.ttlTimer.start(()=>{Object.keys(this._reginData).forEach(t=>{this.getRegion(t).isInvalid()&&this.resetRegion(t)})})}remove(t){return this.ttlTimer.stop(),this}setTtlEnabled(t){this.ttlTimer.setEnabled(t)}setTtlInterval(t){this.ttlTimer.setInterval(t)}initRegion(t,e,i=-1){s.isNull(t,"缓存区域不可为空!"),this._reginData[t]=this.cacheManagerPropertyFactory.newCacheRegion(this,t,e),this.ttl(t,i),this.onChange(t)}resetRegion(t){this.getRegion(t).clearValue(),this.onChange(t)}getRegion(t,e){s.isNull(t,"缓存区域不可为空!");let i=this._reginData[t];return i||(i=this._reginData[t]=this.cacheManagerPropertyFactory.newCacheRegion(this,t,e)),i}setValue(t,e,s){this.getRegion(t).setValue(e,s),this.onChange(t)}getValue(t,e,s){const i=this.getRegion(t);let r=i.getValue(e);return void 0===r&&void 0!==s&&(r=s,i.setValue(e,s)),this.deepClone(r)}setRegionData(t,e,s=-1){this.getRegion(t).setRegionData(e),this.ttl(t,-1),this.onChange(t)}getRegionData(t,e){const s=this.getRegion(t);let i=s.getRegionData();return void 0===i&&void 0!==e&&(i=e,s.setRegionData(e)),this.deepClone(i)}deepClone(t){return this._app&&void 0!==t?this._app.getPlugin("dataCopier").deepClone(t):t}encodeData(t){return this._app?this._app.getPlugin("dataContract").encode(t):t}decodeData(t){return this._app?this._app.getPlugin("dataContract").decode(t):t}onChange(t){this._queue.size&&setTimeout(()=>{this.sync()},0),this._queue.add(t)}sync(){const t=[];this._queue.forEach(e=>{t.push(e)}),this._queue.clear(),t.forEach(t=>{this.getRegion(t).sync()})}ttl(t,e){this.getRegion(t).setTtl(e)}}class o{constructor(t,e,s){if(this.ttl=-1,this._simpleKey="_s",this._empty=!1,this._cacheManager=t,this._regionName=e,void 0===s){let t=this._cacheManager.storageProvider.getItem(this._regionName);t=t?this._cacheManager.decodeData(t):"{}",s=JSON.parse(t)}else if("object"==typeof s)s=this._cacheManager.deepClone(s);else{const t={};t[this._simpleKey]=s,s=t}this._data=s,this.ttl=-1}setTtl(t){this.ttl=t<=0?-1:(new Date).getTime()+t}isInvalid(){return-1!==this.ttl&&this.ttl<=(new Date).getTime()}setRegionData(t){s.isNull(t,"值不可为空!"),"object"==typeof t?this._data=this._cacheManager.deepClone(t):this._data[this._simpleKey]=t,this._empty=!1}getRegionData(){if(!this._empty){if(this.isSimple())return this._data[this._simpleKey];if(Object.keys(this._data).length)return this._data}}setValue(t,e){void 0===e?delete this._data[t]:this._data[t]=this._cacheManager.deepClone(e),this._empty=!1}getValue(t){const e=this._data[t];if(e)return e}sync(){const t=this._cacheManager.deepClone(this._data);this._cacheManager.storageProvider.setItem(this._regionName,this._cacheManager.encodeData(JSON.stringify(t)))}clearValue(){this._empty=!0,this.ttl=-1,Object.keys(this._data).forEach(t=>{delete this._data[t]})}isSimple(){const t=Object.keys(this._data);return 1===t.length&&t[0]===this._simpleKey}}class h extends l{constructor(){super(localStorage,new a)}}class c extends l{constructor(){super(sessionStorage,new a)}}class u extends l{constructor(){const t={};super({getItem:e=>t[e],setItem(e,s){t[e]=s},removeItem(e){delete t[e]}},new a)}}class g{constructor(){this.splitter="$"}buildKey(t,e){let s="";return Object.keys(t).length?Array.isArray(e)?e.forEach((e,i)=>{s+=t[e]+this.splitter+i}):s=t[e]:s=t,s}}var d=new class{collectInnerVal(t=[],e=["children"],s,i=1){let r=[];s||(s={buildValue:t=>t});const n=i-1;for(let i=0;i<t.length;i++){const a=t[i][e[n]]||[];0===n?r=r.concat(a.map(t=>s.buildValue(t))):a.length&&(r=r.concat(this.collectInnerVal(a,e,s,n)))}return r}arrayToTree(t=[],e="id",s="parentId",i="children",r="_root"){const n=new Set,a=new Set,l={};t.forEach((function(t){const o=t[e];let h=l[o];t[i]=h?h[i]:[],l[o]=t;const c=t[s]||r;if(c){a.has(c)||(n.add(c),a.add(c));let s=l[c];s||(l[c]=s={},s[i]=[],s[e]=c),n.delete(o),a.add(o),s[i].push(t)}}));const o=[];return l[r]?(l[r].children||[]).forEach(t=>{o.push(t)}):n.forEach(t=>{o.push(l[t])}),o}distinctArray(t=[],e="",s=new g){const i=new Set,r=[];for(let n=0;n<t.length;n++){const a=t[n];let l=s.buildKey(a,e);i.has(l)||(i.add(l),r.push(a))}return r}getNamesByKeys(t=[],e=[],s="label",i="value"){if(!e||!e.length)return e||[];"string"==typeof e&&(e=e.split(","));const r=this.toMap(t,i,s),n=[];return e.forEach(t=>{const e=r[t];n.push(e)}),n}toMap(t=[],e,s){const i={};if("string"==typeof e){const t=e;e={buildKey:e=>e[t]}}if(s){if("string"==typeof s){const t=s;s={buildValue:e=>e[t]}}}else s={buildValue:t=>t};return t.forEach(t=>{const r=e.buildKey(t);i[r]=s.buildValue(t)}),i}};var p=new class{constructor(){this.date_formatter_long="yyyy-MM-dd HH:mm:ss",this.date_formatter_short="yyyy-MM-dd"}getDate(t){return null==t&&(t=new Date),"string"==typeof t&&(t=this.stringToDate(t)),t}dateToString(t,e){let s;if(!t)return"";e||(e="yyyy-MM-dd");const i={"y+":(t=this.getDate(t)).getFullYear().toString(),"M+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"m+":t.getMinutes().toString(),"s+":t.getSeconds().toString()};for(let t in i)s=new RegExp("("+t+")").exec(e),s&&(e=e.replace(s[1],1===s[1].length?i[t]:this.padStart(i[t],s[1].length,"0")));return e}stringToDate(t,e){if(s.isEmpty(t,"时间字符串不能为空!"),e){let s="1970",i="01",r="01",n="00",a="00",l="00",o=e.indexOf("yyyy");o>-1&&(s=t.substring(o,o+4)),o=e.indexOf("MM"),o>-1&&(i=t.substring(o,o+2)),o=e.indexOf("dd"),o>-1&&(r=t.substring(o,o+2)),o=e.indexOf("HH"),o>-1&&(n=t.substring(o,o+2)),o=e.indexOf("mm"),o>-1&&(a=t.substring(o,o+2)),o=e.indexOf("ss"),o>-1&&(l=t.substring(o,o+2)),t=s+"-"+i+"-"+r+" "+n+":"+a+":"+l}return new Date(t.replace(/-/g,"/"))}padStart(t,e,s){let i="",r=0;t?r=e-t.length:t="";for(let t=0;t<r;t++)i+=s;return i+t}addDay(t,e){if(!t)return;t=this.getDate(t);let s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return s.setDate(s.getDate()+e),s}addMonth(t,e){if(!t)return;t=this.getDate(t);let s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return s.setMonth(s.getMonth()+e),s}addYear(t,e){if(!t)return;t=this.getDate(t);let s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return s.setFullYear(s.getFullYear()+e),s}getWeekDate(t,e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]){if(!t)return"";return e[this.getDate(t).getDay()]}subDay(t,e){const s=this.getDate(t),i=this.getDate(e),r=Math.abs(s.getTime()-i.getTime());return parseInt(String(r/864e5))}subMonth(t,e){t=this.dateToString(t,"yyyy-MM-dd"),e=this.dateToString(e,"yyyy-MM-dd");const s=t.split("-"),i=e.split("-"),r=parseInt(s[0]),n=parseInt(i[0]),a=parseInt(s[1]),l=parseInt(i[1]);return Math.abs(12*(n-r)+(l-a)+1)}subYear(t,e){t=this.dateToString(t,"yyyy-MM-dd"),e=this.dateToString(e,"yyyy-MM-dd");const s=t.split("-"),i=e.split("-"),r=parseInt(s[0]),n=parseInt(i[0]);return Math.abs(n-r)}getDaysOfMonths(t){let e;e=t?this.getDate(t):new Date;const s=e.getMonth();return e.setMonth(s+1),e.setDate(0),e.getDate()}getDatesInRange(t,e,s=!0){const i=[];let r=0,n=this.dateToString(t,this.date_formatter_short);const a=this.dateToString(e,this.date_formatter_short);let l=this.stringToDate(n);do{i[r]=s?this.stringToDate(n):n,l.setDate(l.getDate()+1),n=this.dateToString(l,this.date_formatter_short),r++}while(-1!==a.localeCompare(n));return i}};var y=new class{isEmpty(t){return void 0===t||(null==t||"null"==t||"undefined"==t||""==(t+"").replace(/　/g,"").trim())}pad(t,e){let s=t.toString().length;for(;s<e;)t="0"+t,s++;return t}numberValueAdd(t,e){let s,i,r;try{s=t.toString().split(".")[1].length}catch(t){s=0}try{i=e.toString().split(".")[1].length}catch(t){i=0}r=Math.pow(10,Math.max(s,i));const n=this.numberValueMultiply(t,r)+this.numberValueMultiply(e,r);let a=this.numberValueDivide(n,r);return isNaN(a)&&(a=0),a}numberValueSubtract(t,e){let s,i,r;try{s=t.toString().split(".")[1].length}catch(t){s=0}try{i=e.toString().split(".")[1].length}catch(t){i=0}r=Math.pow(10,Math.max(s,i));const n=this.numberValueMultiply(t,r)-this.numberValueMultiply(e,r);let a=this.numberValueDivide(n,r);return isNaN(a)&&(a=0),a}numberValueDivide(t,e){if(0===e)return 0;let s,i,r=0,n=0;this.isEmpty(t)&&(t=0),this.isEmpty(e)&&(e=1,t=0);try{r=t.toString().split(".")[1].length}catch(t){}try{n=e.toString().split(".")[1].length}catch(t){}return s=Number(t.toString().replace(".","")),i=Number(e.toString().replace(".","")),s/i*Math.pow(10,n-r)}numberValueMultiply(t,e){this.isEmpty(t)&&(t=0),this.isEmpty(e)&&(e=0);let s=0,i=t.toString(),r=e.toString();try{s+=i.split(".")[1].length}catch(t){}try{s+=r.split(".")[1].length}catch(t){}let n=Number(i.replace(".",""))*Number(r.replace(".",""))/Math.pow(10,s);return isNaN(n)&&(n=0),n}changeDp(t,e){let s=parseFloat(t);if(isNaN(s))return 0;const i=Math.pow(10,e);return s=this.numberValueDivide(Math.round(this.numberValueMultiply(s,i)),i),s}};const m=new class{constructor(){this.plugins={},this.pluginsNames=[]}has(t){return!!this.plugins[t]}getPlugin(t){const e=this.plugins[t];return s.isNull(e,"没有注入当前插件:"+t),e}install(t,e){s.isNull(e,"插件不可为空");const i=this.plugins[t];i&&"remove"in i?i.remove(this):this.pluginsNames.push(t),this.plugins[t]=e,e&&"install"in e&&e.install(this)}ready(){this.pluginsNames.forEach(t=>{const e=this.getPlugin(t);"ready"in e&&e.ready(this)})}remove(){this.pluginsNames.forEach(t=>{const e=this.getPlugin(t);"remove"in e&&e.remove(this)})}};m.install("objectUtils",r),m.install("arrayUtils",d),m.install("dateUtils",p),m.install("dataContract",new class{encode(t){return s.isNull(t,"数据不可为空!"),t}decode(t){return s.isNull(t,"数据不可为空!"),t}}),m.install("dataCopier",new class{constructor(){this._objectUtils=r}deepClone(t){return s.isNull(t,"数据不可为空!"),this._objectUtils.deepClone(t)}simpleClone(t){return s.isNull(t,"数据不可为空!"),Object.assign({},t)}install(t){}ready(t){this._objectUtils=t.getPlugin("objectUtils")}remove(t){}}),m.install("mathUtils",y);const b=new class{constructor(){this.cache=new i}};Date.prototype.toJSON=function(){return m.getPlugin("dateUtils").dateToString(this,"yyyy-MM-dd hh:mm:ss")};const f=t=>{if(!t)return;const e=t.pluginName||"cacheManager";let s;if(m.has(e))s=m.getPlugin(e);else{switch(t.type){case"Memory":s=new u;break;case"Session":s=new c;break;default:s=new h}m.install(e,s)}s.setTtlEnabled(t.ttlEnabled),s.setTtlInterval(t.ttlInterval)};t.appConfig=b,t.appStore=m,t.installer=t=>{t.compiled&&t.compiled(b,m),b.cache&&f(b.cache),t.beforeReady&&t.beforeReady(m),m.ready(),t.afterReady&&t.afterReady(m)},Object.defineProperty(t,"__esModule",{value:!0})}));