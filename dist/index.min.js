!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).index=t.index||{})}(this,(function(t){"use strict";class e{error(t,e){throw console.error(t),new Error(e)}}class r{constructor(){this._defaultErrorHandler=new e}isNull(t,e,r=this._defaultErrorHandler){void 0!==t&&""!==t&&null!==t||r.error([t],e)}isNotNull(t,e,r=this._defaultErrorHandler){void 0!==t&&""!==t&&null!==t&&r.error([t],e)}isEmpty(t,e,r=this._defaultErrorHandler){this.isNull(t,e,r),Array.isArray(t)&&0===t.length&&r.error([t],e)}isNotEmpty(t,e,r=this._defaultErrorHandler){this.isNotNull(t,e,r),Array.isArray(t)&&t.length>0&&r.error([t],e)}}var s=new r,a=Object.freeze({__proto__:null,ConsoleErrorHandler:e,Asserts:r,default:s});class i{constructor(){this.cache=new n}}class n{constructor(){this.type="Local",this.pluginName="cacheManager",this.ttlEnabled=!0,this.ttlInterval=15e3}}class l{constructor(){this.plugins={},this.pluginsNames=[]}has(t){return!!this.plugins[t]}getPlugin(t){const e=this.plugins[t];return s.isNull(e,"没有注入当前插件:"+t),e}install(t,e){s.isNull(e,"插件不可为空");const r=this.plugins[t];r&&"remove"in r?r.remove(this):this.pluginsNames.push(t),this.plugins[t]=e,e&&"install"in e&&e.install(this)}ready(){this.pluginsNames.forEach(t=>{const e=this.getPlugin(t);"ready"in e&&e.ready(this)})}remove(){this.pluginsNames.forEach(t=>{const e=this.getPlugin(t);"remove"in e&&e.remove(this)})}}var o=Object.freeze({__proto__:null,AppConfig:i,CacheConfig:n,AppStore:l});class h{constructor(){this.typeMapping={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object","[object Promise]":"Promise"}}isPromise(t){return t&&"object"==typeof t&&t.then&&"function"==typeof t.then}isArray(t){return Array.isArray(t)}isObject(t){return"object"===this.getObjType(t)}addObjType(t,e){let r=Object.prototype.toString;this.typeMapping[r.call(t)]=e}getObjType(t){let e=Object.prototype.toString;if(t instanceof Element)return"element";const r=e.call(t),s=this.typeMapping[r];return s||(r.startsWith("[")&&r.endsWith("]")?r.replace("[object ","").replace("]",""):r)}deepClone(t){let e=this.getObjType(t);if(Array.isArray(t)){let e=[];for(let r=0,s=t.length;r<s;r++)t[r]=(t[r],t[r]),t[r]&&delete t[r].$parent,e.push(this.deepClone(t[r]));return e}if("object"===e){let e={};for(let r in t)t&&delete t.$parent,e[r]=this.deepClone(t[r]);return e}return t}isEmpty(t){if(void 0===t)return!0;const e=this.getObjType(t);return"string"===e&&""===t||("array"===e&&!t.length||!(!t.isEmpty||!t.isEmpty()))}isNotEmpty(t){return!this.isEmpty(t)}}var c=new h,u=Object.freeze({__proto__:null,ObjectUtils:h,default:c});class g{constructor(){this.splitter="$"}buildKey(t,e){let r="";return Object.keys(t).length?Array.isArray(e)?e.forEach((e,s)=>{r+=t[e]+this.splitter+s}):r=t[e]:r=t,r}}class d{collectInnerVal(t=[],e=["children"],r,s=1){let a=[];r||(r={buildValue:t=>t});const i=s-1;for(let s=0;s<t.length;s++){const n=t[s][e[i]]||[];0===i?a=a.concat(n.map(t=>r.buildValue(t))):n.length&&(a=a.concat(this.collectInnerVal(n,e,r,i)))}return a}treeToArray(t=[],e="id",r="parentId",s="children",a=!1){const i=[];if(!t)return i;const n=t=>{if(!t)return;i.push(t);(t[s]||[]).forEach(s=>{s[r]=t[e],n(s)}),a&&delete t[s]};return Array.isArray(t)?(t.forEach(t=>{n(t)}),i):(n(t),(null==i?void 0:i.length)?i[0]:[])}arrayToTree(t=[],e="id",r="parentId",s="children"){const a=new Set,i=new Set,n={},l=[],o=[];t.forEach((function(t){const h=t[e];let c=n[h];t[s]=c?c[s]:[],n[h]=t;const u=t[r];if(u){i.has(u)||(a.add(u),i.add(u));let r=n[u];r||(n[u]=r={},r[s]=[],r[e]=u),a.delete(h),i.add(h),r[s].push(t)}else o.push(h),l.push(t)}));const h=[];return a.forEach(t=>{-1===o.indexOf(t)&&h.push(n[t])}),h.push(...l),h}distinctArray(t=[],e="",r=new g){const s=new Set,a=[];for(let i=0;i<t.length;i++){const n=t[i];let l=r.buildKey(n,e);s.has(l)||(s.add(l),a.push(n))}return a}getNamesByKeys(t=[],e=[],r="label",s="value"){if(!e||!e.length)return e||[];"string"==typeof e&&(e=e.split(","));const a=this.toMap(t,s,r),i=[];return e.forEach(t=>{const e=a[t];i.push(e)}),i}toMap(t=[],e,r){const s={};if("string"==typeof e){const t=e;e={buildKey:e=>e[t]}}if(r){if("string"==typeof r){const t=r;r={buildValue:e=>e[t]}}}else r={buildValue:t=>t};return t.forEach(t=>{const a=e.buildKey(t);s[a]=r.buildValue(t)}),s}}var p=new d,y=Object.freeze({__proto__:null,GeneralKeyBuilder:g,ArrayUtils:d,default:p});class b{constructor(){this.date_formatter_long="yyyy-MM-dd HH:mm:ss",this.date_formatter_short="yyyy-MM-dd"}getDate(t){return null==t&&(t=new Date),"string"==typeof t&&(t=this.stringToDate(t)),t}dateToString(t,e){let r;if(!t)return"";e||(e="yyyy-MM-dd");const s={"y+":(t=this.getDate(t)).getFullYear().toString(),"M+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"m+":t.getMinutes().toString(),"s+":t.getSeconds().toString()};for(let t in s)r=new RegExp("("+t+")").exec(e),r&&(e=e.replace(r[1],1===r[1].length?s[t]:this.padStart(s[t],r[1].length,"0")));return e}stringToDate(t,e){if(s.isEmpty(t,"时间字符串不能为空!"),e){let r="1970",s="01",a="01",i="00",n="00",l="00",o=e.indexOf("yyyy");o>-1&&(r=t.substring(o,o+4)),o=e.indexOf("MM"),o>-1&&(s=t.substring(o,o+2)),o=e.indexOf("dd"),o>-1&&(a=t.substring(o,o+2)),o=e.indexOf("HH"),o>-1&&(i=t.substring(o,o+2)),o=e.indexOf("mm"),o>-1&&(n=t.substring(o,o+2)),o=e.indexOf("ss"),o>-1&&(l=t.substring(o,o+2)),t=r+"-"+s+"-"+a+" "+i+":"+n+":"+l}return new Date(t.replace(/-/g,"/"))}padStart(t,e,r){let s="",a=0;t?a=e-t.length:t="";for(let t=0;t<a;t++)s+=r;return s+t}addDay(t,e){if(!t)return;t=this.getDate(t);let r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return r.setDate(r.getDate()+e),r}addMonth(t,e){if(!t)return;t=this.getDate(t);let r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return r.setMonth(r.getMonth()+e),r}addYear(t,e){if(!t)return;t=this.getDate(t);let r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return r.setFullYear(r.getFullYear()+e),r}getWeekDate(t,e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]){if(!t)return"";return e[this.getDate(t).getDay()]}subDay(t,e){const r=this.getDate(t),s=this.getDate(e),a=Math.abs(r.getTime()-s.getTime());return parseInt(String(a/864e5))}subMonth(t,e){t=this.dateToString(t,"yyyy-MM-dd"),e=this.dateToString(e,"yyyy-MM-dd");const r=t.split("-"),s=e.split("-"),a=parseInt(r[0]),i=parseInt(s[0]),n=parseInt(r[1]),l=parseInt(s[1]);return Math.abs(12*(i-a)+(l-n)+1)}subYear(t,e){t=this.dateToString(t,"yyyy-MM-dd"),e=this.dateToString(e,"yyyy-MM-dd");const r=t.split("-"),s=e.split("-"),a=parseInt(r[0]),i=parseInt(s[0]);return Math.abs(i-a)}getDaysOfMonths(t){let e;e=t?this.getDate(t):new Date;const r=e.getMonth();return e.setMonth(r+1),e.setDate(0),e.getDate()}getDatesInRange(t,e,r=!0){const s=[];let a=0,i=this.dateToString(t,this.date_formatter_short);const n=this.dateToString(e,this.date_formatter_short);let l=this.stringToDate(i);do{s[a]=r?this.stringToDate(i):i,l.setDate(l.getDate()+1),i=this.dateToString(l,this.date_formatter_short),a++}while(-1!==n.localeCompare(i));return s}trunc(t,e="day"){t=this.getDate(t);let r="";switch(e){case"year":r=this.dateToString(t,"yyyy")+"-01-01 00:00:00";break;case"month":r=this.dateToString(t,"yyyy-MM")+"-01 00:00:00";break;case"day":r=this.dateToString(t,"yyyy-MM-dd")+" 00:00:00";break;case"hour":r=this.dateToString(t,"yyyy-MM-dd HH")+" :00:00";break;case"minute":r=this.dateToString(t,"yyyy-MM-dd HH:mm")+":00"}return this.stringToDate(r,this.date_formatter_long)}}var f=new b,_=Object.freeze({__proto__:null,DateUtils:b,default:f});class m{isEmpty(t){return void 0===t||(null==t||"null"==t||"undefined"==t||""==(t+"").replace(/　/g,"").trim())}pad(t,e){let r=t.toString().length;for(;r<e;)t="0"+t,r++;return t}numberValueAdd(t,e){let r,s,a;try{r=t.toString().split(".")[1].length}catch(t){r=0}try{s=e.toString().split(".")[1].length}catch(t){s=0}a=Math.pow(10,Math.max(r,s));const i=this.numberValueMultiply(t,a)+this.numberValueMultiply(e,a);let n=this.numberValueDivide(i,a);return isNaN(n)&&(n=0),n}numberValueSubtract(t,e){let r,s,a;try{r=t.toString().split(".")[1].length}catch(t){r=0}try{s=e.toString().split(".")[1].length}catch(t){s=0}a=Math.pow(10,Math.max(r,s));const i=this.numberValueMultiply(t,a)-this.numberValueMultiply(e,a);let n=this.numberValueDivide(i,a);return isNaN(n)&&(n=0),n}numberValueDivide(t,e){if(0===e)return 0;let r,s,a=0,i=0;this.isEmpty(t)&&(t=0),this.isEmpty(e)&&(e=1,t=0);try{a=t.toString().split(".")[1].length}catch(t){}try{i=e.toString().split(".")[1].length}catch(t){}return r=Number(t.toString().replace(".","")),s=Number(e.toString().replace(".","")),r/s*Math.pow(10,i-a)}numberValueMultiply(t,e){this.isEmpty(t)&&(t=0),this.isEmpty(e)&&(e=0);let r=0,s=t.toString(),a=e.toString();try{r+=s.split(".")[1].length}catch(t){}try{r+=a.split(".")[1].length}catch(t){}let i=Number(s.replace(".",""))*Number(a.replace(".",""))/Math.pow(10,r);return isNaN(i)&&(i=0),i}changeDp(t,e){let r=parseFloat(t);if(isNaN(r))return 0;const s=Math.pow(10,e);return r=this.numberValueDivide(Math.round(this.numberValueMultiply(r,s)),s),r}}var M=new m,D=Object.freeze({__proto__:null,MathUtils:m,default:M});class S{constructor(t=15e3,e,r){this.enabled=!0,this.running=!1,this.interval=t,this._targetProxyJob=new j(e,r)}start(){this.running||this.interval>0&&this.enabled&&(this.running=!0,this.timerId=setInterval(()=>{this._targetProxyJob.invoke()},this.interval))}updateThat(t){this._targetProxyJob.that=t}updateTargetFun(t){this._targetProxyJob.targetFun=t}stop(){this.running&&clearInterval(this.timerId),this.running=!1}setInterval(t=15e3){this.interval=t,this.running&&(this.stop(),this.start())}}class j{constructor(t,e){this.targetFun=t,this.that=e}invoke(){this.targetFun&&(this.that?this.targetFun.call(this.that,this.that):this.targetFun())}}var v=Object.freeze({__proto__:null,GeneralTimer:S,GeneralTimerJob:j});class T{newCacheRegion(t,e,r){return new O(t,e,r)}newTimer(t){return new S(15e3,t=>{Object.keys(t._reginData).forEach(e=>{t.getRegion(e).isInvalid()&&t.resetRegion(e)})},t)}}class w{constructor(t,e){this._reginData={},this._queue=new Set,this.ttlEnable=!1,this.cacheManagerPropertyFactory=e,this.storageProvider=t,this.ttlTimer=e.newTimer(this)}install(t){this._app=t}ready(t){this.ttlEnable&&this.ttlTimer.start()}remove(t){return this.ttlTimer.stop(),this}setTtlEnabled(t){this.ttlEnable=t}setTtlInterval(t){this.ttlTimer.setInterval(t)}initRegion(t,e,r=-1){s.isNull(t,"缓存区域不可为空!"),this._reginData[t]=this.cacheManagerPropertyFactory.newCacheRegion(this,t,e),this.ttl(t,r),this.sync(t),this.onChange(t)}resetRegion(t){this.getRegion(t).clearValue(!0)}getRegion(t,e){s.isNull(t,"缓存区域不可为空!");let r=this._reginData[t];return r||(r=this._reginData[t]=this.cacheManagerPropertyFactory.newCacheRegion(this,t,e)),r}setValue(t,e,r){this.getRegion(t).setValue(e,r),this.onChange(t)}getValue(t,e,r){const s=this.getRegion(t);let a=s.getValue(e);return void 0===a&&void 0!==r&&(a=r,s.setValue(e,r)),this.deepClone(a)}setRegionData(t,e,r=-1){this.getRegion(t).setRegionData(e),this.ttl(t,-1),this.onChange(t)}getRegionData(t,e){const r=this.getRegion(t);let s=r.getRegionData();return void 0===s&&void 0!==e&&(s=e,r.setRegionData(e)),this.deepClone(s)}deepClone(t){return this._app&&void 0!==t?this._app.getPlugin("dataCopier").deepClone(t):t}encodeData(t){return this._app?this._app.getPlugin("dataContract").encode(t):t}decodeData(t){return this._app?this._app.getPlugin("dataContract").decode(t):t}onChange(t){this._queue.size&&setTimeout(()=>{this.sync()},0),this._queue.add(t)}sync(t){const e=[];t?Array.isArray(t)?e.push(...t):e.push(t):(this._queue.forEach(t=>{e.push(t)}),this._queue.clear()),e.forEach(t=>{this.getRegion(t).sync()})}refresh(t){const e=[];t?Array.isArray(t)?e.push(...t):e.push(t):Object.keys(this._reginData).forEach(t=>{e.push(t)}),e.forEach(t=>{this.getRegion(t).refresh()})}ttl(t,e){this.getRegion(t).setTtl(e)}}class O{constructor(t,e,r){if(this.ttl=-1,this._simpleKey="_s",this._empty=!1,this._cacheManager=t,this._regionName=e,void 0===r){let t=this._cacheManager.storageProvider.getItem(this._regionName);t=t?this._cacheManager.decodeData(t):"{}",r=JSON.parse(t)}else if("object"==typeof r)r=this._cacheManager.deepClone(r);else{const t={};t[this._simpleKey]=r,r=t}this._data=r,this.ttl=-1}setTtl(t){this.ttl=t<=0?-1:(new Date).getTime()+t}isInvalid(){return-1!==this.ttl&&this.ttl<=(new Date).getTime()}setRegionData(t){s.isNull(t,"值不可为空!"),"object"==typeof t?this._data=this._cacheManager.deepClone(t):this._data[this._simpleKey]=t,this._empty=!1}getRegionData(){if(!this._empty){if(this.isSimple())return this._data[this._simpleKey];if(Object.keys(this._data).length)return this._data}}setValue(t,e){void 0===e?delete this._data[t]:this._data[t]=this._cacheManager.deepClone(e),this._empty=!1}getValue(t){const e=this._data[t];if(e)return e}sync(){const t=this._cacheManager.deepClone(this._data);this._cacheManager.storageProvider.setItem(this._regionName,this._cacheManager.encodeData(JSON.stringify(t)))}refresh(){let t=this._cacheManager.storageProvider.getItem(this._regionName);t=t?this._cacheManager.decodeData(t):"{}",this._data=JSON.parse(t)}clearValue(t=!1){this._empty=!0,this.ttl=-1,Array.isArray(this._data)?this._data=[]:this._data={},t&&this.sync()}isSimple(){const t=Object.keys(this._data);return 1===t.length&&t[0]===this._simpleKey}}var N=Object.freeze({__proto__:null,AbstractCacheManager:w,CacheRegion:O,LocalStorageCacheManager:class extends w{constructor(){super(localStorage,new T)}},SessionStorageCacheManager:class extends w{constructor(){super(sessionStorage,new T)}},MemoryStorageCacheManager:class extends w{constructor(){const t={};super({getItem:e=>t[e],setItem(e,r){t[e]=r},removeItem(e){delete t[e]}},new T)}}});var E=Object.freeze({__proto__:null,UnsetDataContract:class{encode(t){return s.isNull(t,"数据不可为空!"),t}decode(t){return s.isNull(t,"数据不可为空!"),t}}});var C=Object.freeze({__proto__:null,GeneralDataCopier:class{constructor(){this._objectUtils=c}deepClone(t){return s.isNull(t,"数据不可为空!"),this._objectUtils.deepClone(t)}simpleClone(t){return s.isNull(t,"数据不可为空!"),Object.assign({},t)}install(t){}ready(t){this._objectUtils=t.getPlugin("objectUtils")}remove(t){}}});const R=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},v),N),E),C),o),y),u),_),D),a),I=new l;I.install("objectUtils",c),I.install("arrayUtils",p),I.install("dateUtils",f),I.install("dataContract",new R.UnsetDataContract),I.install("dataCopier",new R.GeneralDataCopier),I.install("mathUtils",M);const A=new i;Date.prototype.toJSON=function(){return I.getPlugin("dateUtils").dateToString(this,"yyyy-MM-dd HH:mm:ss")};const V=t=>{if(!t)return;const e=t.pluginName||"cacheManager";let r;if(I.has(e))r=I.getPlugin(e);else{switch(t.type){case"Memory":r=new R.MemoryStorageCacheManager;break;case"Session":r=new R.SessionStorageCacheManager;break;default:r=new R.LocalStorageCacheManager}I.install(e,r)}r.setTtlEnabled(t.ttlEnabled),r.setTtlInterval(t.ttlInterval)};t.appConfig=A,t.appStore=I,t.default=R,t.installer=t=>{t.compiled&&t.compiled(A,I),A.cache&&V(A.cache),t.beforeReady&&t.beforeReady(I),I.ready(),t.afterReady&&t.afterReady(I)},Object.defineProperty(t,"__esModule",{value:!0})}));