!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).index=t.index||{})}(this,(function(t){"use strict";class e{error(t,e){throw console.error(t),new Error(e)}}var s=new class{constructor(){this._defaultErrorHandler=new e}isNull(t,e,s=this._defaultErrorHandler){void 0!==t&&""!==t&&null!==t||s.error([t],e)}isNotNull(t,e,s=this._defaultErrorHandler){void 0!==t&&""!==t&&null!==t&&s.error([t],e)}isEmpty(t,e,s=this._defaultErrorHandler){this.isNull(t,e,s),Array.isArray(t)&&0===t.length&&s.error([t],e)}isNotEmpty(t,e,s=this._defaultErrorHandler){this.isNotNull(t,e,s),Array.isArray(t)&&t.length>0&&s.error([t],e)}};class r{constructor(){this.type="Local",this.pluginName="cacheManager",this.ttlEnabled=!0,this.ttlInterval=1e3}}var i=new class{constructor(){this.typeMapping={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object","[object Promise]":"Promise"}}isPromise(t){return t&&"object"==typeof t&&t.then&&"function"==typeof t.then}isArray(t){return Array.isArray(t)}isObject(t){return"object"===this.getObjType(t)}addObjType(t,e){let s=Object.prototype.toString;this.typeMapping[s.call(t)]=e}getObjType(t){let e=Object.prototype.toString;if(t instanceof Element)return"element";const s=e.call(t),r=this.typeMapping[s];return r||(s.startsWith("[")&&s.endsWith("]")?s.replace("[object ","").replace("]",""):s)}deepClone(t){let e=this.getObjType(t);if(Array.isArray(t)){let e=[];for(let s=0,r=t.length;s<r;s++)t[s]=(t[s],t[s]),t[s]&&delete t[s].$parent,e.push(this.deepClone(t[s]));return e}if("object"===e){let e={};for(let s in t)t&&delete t.$parent,e[s]=this.deepClone(t[s]);return e}return t}};class n{constructor(t=15e3){this.enabled=!0,this.interval=t}start(t,e){this.stop(),this.interval>0&&this.enabled&&(this.timerId=setInterval(()=>{t(e)},this.interval))}stop(){clearInterval(this.timerId)}setEnabled(t){this.enabled=t}setInterval(t=15e3){this.interval=t}}class a{newCacheRegion(t,e,s){return new o(t,e,s)}newTimer(){return new n}}class l{constructor(t,e){this._reginData={},this._queue=new Set,this.cacheManagerPropertyFactory=e,this.storageProvider=t,this.ttlTimer=e.newTimer()}install(t){this._app=t}ready(t){this.ttlTimer.start(()=>{Object.keys(this._reginData).forEach(t=>{this.getRegion(t).isInvalid()&&this.resetRegion(t)})})}remove(t){return this.ttlTimer.stop(),this}setTtlEnabled(t){this.ttlTimer.setEnabled(t)}setTtlInterval(t){this.ttlTimer.setInterval(t)}initRegion(t,e,r=-1){s.isNull(t,"缓存区域不可为空!"),this._reginData[t]=this.cacheManagerPropertyFactory.newCacheRegion(this,t,e),this.ttl(t,r),this.onChange(t)}resetRegion(t){this.getRegion(t).clearValue(!0)}getRegion(t,e){s.isNull(t,"缓存区域不可为空!");let r=this._reginData[t];return r||(r=this._reginData[t]=this.cacheManagerPropertyFactory.newCacheRegion(this,t,e)),r}setValue(t,e,s){this.getRegion(t).setValue(e,s),this.onChange(t)}getValue(t,e,s){const r=this.getRegion(t);let i=r.getValue(e);return void 0===i&&void 0!==s&&(i=s,r.setValue(e,s)),this.deepClone(i)}setRegionData(t,e,s=-1){this.getRegion(t).setRegionData(e),this.ttl(t,-1),this.onChange(t)}getRegionData(t,e){const s=this.getRegion(t);let r=s.getRegionData();return void 0===r&&void 0!==e&&(r=e,s.setRegionData(e)),this.deepClone(r)}deepClone(t){return this._app&&void 0!==t?this._app.getPlugin("dataCopier").deepClone(t):t}encodeData(t){return this._app?this._app.getPlugin("dataContract").encode(t):t}decodeData(t){return this._app?this._app.getPlugin("dataContract").decode(t):t}onChange(t){this._queue.size&&setTimeout(()=>{this.sync()},0),this._queue.add(t)}sync(){const t=[];this._queue.forEach(e=>{t.push(e)}),this._queue.clear(),t.forEach(t=>{this.getRegion(t).sync()})}ttl(t,e){this.getRegion(t).setTtl(e)}}class o{constructor(t,e,s){if(this.ttl=-1,this._simpleKey="_s",this._empty=!1,this._cacheManager=t,this._regionName=e,void 0===s){let t=this._cacheManager.storageProvider.getItem(this._regionName);t=t?this._cacheManager.decodeData(t):"{}",s=JSON.parse(t)}else if("object"==typeof s)s=this._cacheManager.deepClone(s);else{const t={};t[this._simpleKey]=s,s=t}this._data=s,this.ttl=-1}setTtl(t){this.ttl=t<=0?-1:(new Date).getTime()+t}isInvalid(){return-1!==this.ttl&&this.ttl<=(new Date).getTime()}setRegionData(t){s.isNull(t,"值不可为空!"),"object"==typeof t?this._data=this._cacheManager.deepClone(t):this._data[this._simpleKey]=t,this._empty=!1}getRegionData(){if(!this._empty){if(this.isSimple())return this._data[this._simpleKey];if(Object.keys(this._data).length)return this._data}}setValue(t,e){void 0===e?delete this._data[t]:this._data[t]=this._cacheManager.deepClone(e),this._empty=!1}getValue(t){const e=this._data[t];if(e)return e}sync(){const t=this._cacheManager.deepClone(this._data);this._cacheManager.storageProvider.setItem(this._regionName,this._cacheManager.encodeData(JSON.stringify(t)))}clearValue(t=!1){this._empty=!0,this.ttl=-1,Object.keys(this._data).forEach(t=>{delete this._data[t]}),t&&this.sync()}isSimple(){const t=Object.keys(this._data);return 1===t.length&&t[0]===this._simpleKey}}class h extends l{constructor(){super(localStorage,new a)}}class c extends l{constructor(){super(sessionStorage,new a)}}class u extends l{constructor(){const t={};super({getItem:e=>t[e],setItem(e,s){t[e]=s},removeItem(e){delete t[e]}},new a)}}class g{constructor(){this.splitter="$"}buildKey(t,e){let s="";return Object.keys(t).length?Array.isArray(e)?e.forEach((e,r)=>{s+=t[e]+this.splitter+r}):s=t[e]:s=t,s}}var d=new class{collectInnerVal(t=[],e=["children"],s,r=1){let i=[];s||(s={buildValue:t=>t});const n=r-1;for(let r=0;r<t.length;r++){const a=t[r][e[n]]||[];0===n?i=i.concat(a.map(t=>s.buildValue(t))):a.length&&(i=i.concat(this.collectInnerVal(a,e,s,n)))}return i}treeToArray(t,e="id",s="parentId",r="children",i=!1){const n=[];if(!t)return n;const a=t=>{n.push(t);(t[r]||[]).forEach(r=>{r[s]=t[e],a(r)}),i&&delete t[r]};return Array.isArray(t)?(t.forEach(t=>{a(t)}),n):(a(t),(null==n?void 0:n.length)?n[0]:[])}arrayToTree(t=[],e="id",s="parentId",r="children",i="_root"){const n=new Set,a=new Set,l={};t.forEach((function(t){const o=t[e];let h=l[o];t[r]=h?h[r]:[],l[o]=t;const c=t[s]||i;if(c){a.has(c)||(n.add(c),a.add(c));let s=l[c];s||(l[c]=s={},s[r]=[],s[e]=c),n.delete(o),a.add(o),s[r].push(t)}}));const o=[];return l[i]?(l[i].children||[]).forEach(t=>{o.push(t)}):n.forEach(t=>{o.push(l[t])}),o}distinctArray(t=[],e="",s=new g){const r=new Set,i=[];for(let n=0;n<t.length;n++){const a=t[n];let l=s.buildKey(a,e);r.has(l)||(r.add(l),i.push(a))}return i}getNamesByKeys(t=[],e=[],s="label",r="value"){if(!e||!e.length)return e||[];"string"==typeof e&&(e=e.split(","));const i=this.toMap(t,r,s),n=[];return e.forEach(t=>{const e=i[t];n.push(e)}),n}toMap(t=[],e,s){const r={};if("string"==typeof e){const t=e;e={buildKey:e=>e[t]}}if(s){if("string"==typeof s){const t=s;s={buildValue:e=>e[t]}}}else s={buildValue:t=>t};return t.forEach(t=>{const i=e.buildKey(t);r[i]=s.buildValue(t)}),r}};var p=new class{constructor(){this.date_formatter_long="yyyy-MM-dd HH:mm:ss",this.date_formatter_short="yyyy-MM-dd"}getDate(t){return null==t&&(t=new Date),"string"==typeof t&&(t=this.stringToDate(t)),t}dateToString(t,e){let s;if(!t)return"";e||(e="yyyy-MM-dd");const r={"y+":(t=this.getDate(t)).getFullYear().toString(),"M+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"m+":t.getMinutes().toString(),"s+":t.getSeconds().toString()};for(let t in r)s=new RegExp("("+t+")").exec(e),s&&(e=e.replace(s[1],1===s[1].length?r[t]:this.padStart(r[t],s[1].length,"0")));return e}stringToDate(t,e){if(s.isEmpty(t,"时间字符串不能为空!"),e){let s="1970",r="01",i="01",n="00",a="00",l="00",o=e.indexOf("yyyy");o>-1&&(s=t.substring(o,o+4)),o=e.indexOf("MM"),o>-1&&(r=t.substring(o,o+2)),o=e.indexOf("dd"),o>-1&&(i=t.substring(o,o+2)),o=e.indexOf("HH"),o>-1&&(n=t.substring(o,o+2)),o=e.indexOf("mm"),o>-1&&(a=t.substring(o,o+2)),o=e.indexOf("ss"),o>-1&&(l=t.substring(o,o+2)),t=s+"-"+r+"-"+i+" "+n+":"+a+":"+l}return new Date(t.replace(/-/g,"/"))}padStart(t,e,s){let r="",i=0;t?i=e-t.length:t="";for(let t=0;t<i;t++)r+=s;return r+t}addDay(t,e){if(!t)return;t=this.getDate(t);let s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return s.setDate(s.getDate()+e),s}addMonth(t,e){if(!t)return;t=this.getDate(t);let s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return s.setMonth(s.getMonth()+e),s}addYear(t,e){if(!t)return;t=this.getDate(t);let s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return s.setFullYear(s.getFullYear()+e),s}getWeekDate(t,e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]){if(!t)return"";return e[this.getDate(t).getDay()]}subDay(t,e){const s=this.getDate(t),r=this.getDate(e),i=Math.abs(s.getTime()-r.getTime());return parseInt(String(i/864e5))}subMonth(t,e){t=this.dateToString(t,"yyyy-MM-dd"),e=this.dateToString(e,"yyyy-MM-dd");const s=t.split("-"),r=e.split("-"),i=parseInt(s[0]),n=parseInt(r[0]),a=parseInt(s[1]),l=parseInt(r[1]);return Math.abs(12*(n-i)+(l-a)+1)}subYear(t,e){t=this.dateToString(t,"yyyy-MM-dd"),e=this.dateToString(e,"yyyy-MM-dd");const s=t.split("-"),r=e.split("-"),i=parseInt(s[0]),n=parseInt(r[0]);return Math.abs(n-i)}getDaysOfMonths(t){let e;e=t?this.getDate(t):new Date;const s=e.getMonth();return e.setMonth(s+1),e.setDate(0),e.getDate()}getDatesInRange(t,e,s=!0){const r=[];let i=0,n=this.dateToString(t,this.date_formatter_short);const a=this.dateToString(e,this.date_formatter_short);let l=this.stringToDate(n);do{r[i]=s?this.stringToDate(n):n,l.setDate(l.getDate()+1),n=this.dateToString(l,this.date_formatter_short),i++}while(-1!==a.localeCompare(n));return r}};var y=new class{isEmpty(t){return void 0===t||(null==t||"null"==t||"undefined"==t||""==(t+"").replace(/　/g,"").trim())}pad(t,e){let s=t.toString().length;for(;s<e;)t="0"+t,s++;return t}numberValueAdd(t,e){let s,r,i;try{s=t.toString().split(".")[1].length}catch(t){s=0}try{r=e.toString().split(".")[1].length}catch(t){r=0}i=Math.pow(10,Math.max(s,r));const n=this.numberValueMultiply(t,i)+this.numberValueMultiply(e,i);let a=this.numberValueDivide(n,i);return isNaN(a)&&(a=0),a}numberValueSubtract(t,e){let s,r,i;try{s=t.toString().split(".")[1].length}catch(t){s=0}try{r=e.toString().split(".")[1].length}catch(t){r=0}i=Math.pow(10,Math.max(s,r));const n=this.numberValueMultiply(t,i)-this.numberValueMultiply(e,i);let a=this.numberValueDivide(n,i);return isNaN(a)&&(a=0),a}numberValueDivide(t,e){if(0===e)return 0;let s,r,i=0,n=0;this.isEmpty(t)&&(t=0),this.isEmpty(e)&&(e=1,t=0);try{i=t.toString().split(".")[1].length}catch(t){}try{n=e.toString().split(".")[1].length}catch(t){}return s=Number(t.toString().replace(".","")),r=Number(e.toString().replace(".","")),s/r*Math.pow(10,n-i)}numberValueMultiply(t,e){this.isEmpty(t)&&(t=0),this.isEmpty(e)&&(e=0);let s=0,r=t.toString(),i=e.toString();try{s+=r.split(".")[1].length}catch(t){}try{s+=i.split(".")[1].length}catch(t){}let n=Number(r.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,s);return isNaN(n)&&(n=0),n}changeDp(t,e){let s=parseFloat(t);if(isNaN(s))return 0;const r=Math.pow(10,e);return s=this.numberValueDivide(Math.round(this.numberValueMultiply(s,r)),r),s}};const m=new class{constructor(){this.plugins={},this.pluginsNames=[]}has(t){return!!this.plugins[t]}getPlugin(t){const e=this.plugins[t];return s.isNull(e,"没有注入当前插件:"+t),e}install(t,e){s.isNull(e,"插件不可为空");const r=this.plugins[t];r&&"remove"in r?r.remove(this):this.pluginsNames.push(t),this.plugins[t]=e,e&&"install"in e&&e.install(this)}ready(){this.pluginsNames.forEach(t=>{const e=this.getPlugin(t);"ready"in e&&e.ready(this)})}remove(){this.pluginsNames.forEach(t=>{const e=this.getPlugin(t);"remove"in e&&e.remove(this)})}};m.install("objectUtils",i),m.install("arrayUtils",d),m.install("dateUtils",p),m.install("dataContract",new class{encode(t){return s.isNull(t,"数据不可为空!"),t}decode(t){return s.isNull(t,"数据不可为空!"),t}}),m.install("dataCopier",new class{constructor(){this._objectUtils=i}deepClone(t){return s.isNull(t,"数据不可为空!"),this._objectUtils.deepClone(t)}simpleClone(t){return s.isNull(t,"数据不可为空!"),Object.assign({},t)}install(t){}ready(t){this._objectUtils=t.getPlugin("objectUtils")}remove(t){}}),m.install("mathUtils",y);const f=new class{constructor(){this.cache=new r}};Date.prototype.toJSON=function(){return m.getPlugin("dateUtils").dateToString(this,"yyyy-MM-dd HH:mm:ss")};const b=t=>{if(!t)return;const e=t.pluginName||"cacheManager";let s;if(m.has(e))s=m.getPlugin(e);else{switch(t.type){case"Memory":s=new u;break;case"Session":s=new c;break;default:s=new h}m.install(e,s)}s.setTtlEnabled(t.ttlEnabled),s.setTtlInterval(t.ttlInterval)};t.appConfig=f,t.appStore=m,t.installer=t=>{t.compiled&&t.compiled(f,m),f.cache&&b(f.cache),t.beforeReady&&t.beforeReady(m),m.ready(),t.afterReady&&t.afterReady(m)},Object.defineProperty(t,"__esModule",{value:!0})}));